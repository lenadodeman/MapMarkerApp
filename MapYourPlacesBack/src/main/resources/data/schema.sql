DROP TABLE IF EXISTS TOKEN;
DROP TABLE IF EXISTS LOCALISATION_TAG;
DROP TABLE IF EXISTS LOCALISATION;
DROP TABLE IF EXISTS SHARED_TOKEN;
DROP TABLE IF EXISTS TAG;
DROP TABLE IF EXISTS ICON;
DROP TABLE IF EXISTS USERS;


CREATE TABLE USERS
(
    id       BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(255),
    email    VARCHAR(255),
    password VARCHAR(255)
);

CREATE TABLE ICON
(
    id      BIGINT PRIMARY KEY,
    unicode VARCHAR(255)
);

CREATE TABLE TAG
(
    id    BIGINT PRIMARY KEY,
    label VARCHAR(255)
);

CREATE TABLE EXTERNAL_TOKEN
(
    id    BIGINT PRIMARY KEY,
    url   VARCHAR(255),
    token VARCHAR(255)
);

CREATE TABLE LOCALISATION
(
    id          BIGINT PRIMARY KEY,
    name        VARCHAR(255),
    description VARCHAR(255),
    longitude   DECIMAL(10, 6),
    latitude    DECIMAL(10, 6),
    icon_id      BIGINT,
    user_id      BIGINT,
    FOREIGN KEY (icon_id) REFERENCES ICON (id),
    FOREIGN KEY (user_id) REFERENCES USERS (id)
);

CREATE TABLE LOCALISATION_TAG
(
    id             BIGINT PRIMARY KEY,
    tag_id          BIGINT,
    localisation_id BIGINT,
    FOREIGN KEY (tag_id) REFERENCES TAG (id),
    FOREIGN KEY (localisation_id) REFERENCES LOCALISATION (id)
);

CREATE TABLE TOKEN
(
    id             BIGINT PRIMARY KEY,
    modify_right    BOOLEAN,
    creation_date   DATE,
    expiration_date DATE,
    creator_id      BIGINT,
    tag_id         BIGINT,
    localisation_id BIGINT,
    FOREIGN KEY (creator_id) REFERENCES USERS (id),
    FOREIGN KEY (tag_id) REFERENCES TAG (id),
    FOREIGN KEY (localisation_id) REFERENCES LOCALISATION (id),
    CHECK (
        (tag_id IS NOT NULL AND localisation_id IS NULL) OR
        (tag_id IS NULL AND localisation_id IS NOT NULL)
        )
);

CREATE SEQUENCE USERS_SEQ START WITH 100;
CREATE SEQUENCE ICON_SEQ START WITH 100;
CREATE SEQUENCE TAG_SEQ START WITH 100;
CREATE SEQUENCE EXTERNAL_TOKEN_SEQ START WITH 100;
CREATE SEQUENCE LOCALISATION_SEQ START WITH 100;
CREATE SEQUENCE LOCALISATION_TAG_SEQ START WITH 100;
CREATE SEQUENCE TOKEN_SEQ START WITH 100;

